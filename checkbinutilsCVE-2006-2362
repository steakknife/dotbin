#!/bin/sh
set -e

#MIRROR='http://ftpmirror.gnu.org/'
MIRROR='http://mirrors.kernel.org/gnu/'

check_version() {
  curl -LO ${MIRROR}binutils/binutils-$VERSION.tar.bz2 || curl -LO ${MIRROR}binutils/binutils-$VERSION.tar.gz
  tar xf binutils-$VERSION.tar.bz2 || tar xf binutils-$VERSION.tar.gz 
  cd binutils-$VERSION
  grep -B1 'first_phase (' bfd/tekhex.c | grep 'static void'
  rm -rf binutils-$VERSION*
}

VERSIONS='
2.7
2.8
2.8.1
2.9
2.9.1
2.10
2.10.1
2.11
2.11.2
2.12
2.12.1
2.13
2.13.1
2.13.2
2.13.2.1
2.14
2.15
2.16.1
2.17
2.18
2.19
2.19.1
2.20
2.20.1
2.21
2.21.1
2.22
2.23
2.23.1
2.23.2
'

for VERSION in $VERSIONS; do
  if check_version "$VERSION"; then
    echo "$VERSION is vulnerable"
  else 
    echo "$VERSION maybe too old or is patched"
  fi
done
